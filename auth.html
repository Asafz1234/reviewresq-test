<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ReviewResQ – Login / Signup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-page: #f3f4f6;
      --bg-card: #ffffff;
      --accent: #2563eb;
      --accent-soft: #1d4ed8;
      --text-main: #0f172a;
      --text-sub: #4b5563;
      --error: #dc2626;
      --radius-xl: 24px;
      --radius-pill: 999px;
      --shadow-card: 0 22px 55px rgba(15, 23, 42, 0.16);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #e0edff 0, #f3f4f6 40%, #f9fafb 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      padding: 20px;
    }

    .card {
      width: 100%;
      max-width: 420px;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-card);
      padding: 26px 28px 24px;
    }

    .logo {
      text-align: center;
      margin-bottom: 8px;
      font-weight: 800;
      letter-spacing: 0.22em;
      font-size: 13px;
    }

    .logo span {
      color: var(--accent-soft);
    }

    h1 {
      text-align: center;
      margin-bottom: 4px;
      font-size: 22px;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 18px;
    }

    .tabs {
      display: flex;
      margin-bottom: 16px;
      gap: 6px;
      border-radius: 999px;
      background: #e5e7eb66;
      padding: 3px;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 6px 0;
      font-size: 13px;
      border-radius: 999px;
      cursor: pointer;
      color: var(--text-sub);
    }

    .tab.active {
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.12);
      color: var(--accent-soft);
      font-weight: 600;
    }

    .form {
      display: none;
    }

    .form.active {
      display: block;
    }

    .field {
      margin-bottom: 10px;
    }

    .field label {
      display: block;
      font-size: 12px;
      margin-bottom: 4px;
      color: var(--text-sub);
    }

    .field input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      outline: none;
    }

    .field input:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }

    .btn-primary {
      width: 100%;
      margin-top: 4px;
      padding: 10px 0;
      border-radius: var(--radius-pill);
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      color: #eff6ff;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 18px 40px rgba(37, 99, 235, 0.45);
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .helper {
      margin-top: 10px;
      font-size: 12px;
      text-align: center;
      color: var(--text-sub);
    }

    .helper a {
      color: var(--accent-soft);
      text-decoration: none;
      font-weight: 500;
    }

    .message {
      margin-top: 10px;
      font-size: 12px;
      text-align: center;
    }

    .message.error {
      color: var(--error);
    }

    .message.success {
      color: #15803d;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="logo">
      REVIEW<span>RESQ</span>
    </div>
    <h1>Welcome back</h1>
    <p class="subtitle">Log in or create your ReviewResQ account.</p>

    <div class="tabs">
      <div class="tab active" data-tab="login">Login</div>
      <div class="tab" data-tab="signup">Create account</div>
      <div class="tab" data-tab="reset">Forgot password</div>
    </div>

    <!-- LOGIN FORM -->
    <form id="login-form" class="form active">
      <div class="field">
        <label for="login-email">Business email</label>
        <input id="login-email" type="email" autocomplete="email" />
      </div>
      <div class="field">
        <label for="login-password">Password</label>
        <input id="login-password" type="password" autocomplete="current-password" />
      </div>
      <button type="submit" class="btn-primary">Login</button>
    </form>

    <!-- SIGNUP FORM -->
    <form id="signup-form" class="form">
      <div class="field">
        <label for="signup-name">Full name</label>
        <input id="signup-name" type="text" autocomplete="name" />
      </div>
      <div class="field">
        <label for="signup-email">Business email</label>
        <input id="signup-email" type="email" autocomplete="email" />
      </div>
      <div class="field">
        <label for="signup-phone">Business phone</label>
        <input id="signup-phone" type="tel" placeholder="Digits only" />
      </div>
      <div class="field">
        <label for="signup-password">Password</label>
        <input id="signup-password" type="password" autocomplete="new-password" />
      </div>
      <button type="submit" class="btn-primary">Create account</button>
    </form>

    <!-- RESET FORM -->
    <form id="reset-form" class="form">
      <div class="field">
        <label for="reset-email">Business email</label>
        <input id="reset-email" type="email" autocomplete="email" />
      </div>
      <button type="submit" class="btn-primary">Send reset link</button>
    </form>

    <div id="message" class="message"></div>

    <div class="helper">
      Already have an account?
      <a href="#" id="go-login">Log in</a>
    </div>
  </div>

  <script type="module">
    import {
      signUpBusiness,
      loginWithEmailPassword,
      sendPasswordResetLink
    } from "./firebase.js";

    const tabs = document.querySelectorAll(".tab");
    const forms = {
      login: document.getElementById("login-form"),
      signup: document.getElementById("signup-form"),
      reset: document.getElementById("reset-form"),
    };
    const messageEl = document.getElementById("message");
    const goLoginLink = document.getElementById("go-login");

    function setActiveTab(name) {
      tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === name));
      Object.entries(forms).forEach(([key, form]) => {
        form.classList.toggle("active", key === name);
      });
      messageEl.textContent = "";
      messageEl.className = "message";
    }

    tabs.forEach(tab => {
      tab.addEventListener("click", () => setActiveTab(tab.dataset.tab));
    });

    goLoginLink.addEventListener("click", (e) => {
      e.preventDefault();
      setActiveTab("login");
    });

    function showError(msg) {
      messageEl.textContent = msg;
      messageEl.className = "message error";
    }

    function showSuccess(msg) {
      messageEl.textContent = msg;
      messageEl.className = "message success";
    }

    // LOGIN
    forms.login.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;

      try {
        await loginWithEmailPassword(email, password);
        showSuccess("Logged in successfully. Redirecting to dashboard...");
        // TODO: redirect to dashboard.html
        // window.location.href = "/dashboard.html";
      } catch (err) {
        console.error(err);
        showError(err.message || "Login failed. Please check your details.");
      }
    });

    // SIGNUP
    forms.signup.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fullName = document.getElementById("signup-name").value.trim();
      const email = document.getElementById("signup-email").value.trim();
      const phone = document.getElementById("signup-phone").value.trim();
      const password = document.getElementById("signup-password").value;

      try {
        await signUpBusiness({ fullName, email, phone, password });
        showSuccess("Account created! You can now access your dashboard.");
        // TODO: אפשר להפנות ישר לדשבורד אם תרצה
        // window.location.href = "/dashboard.html";
      } catch (err) {
        console.error(err);
        showError(err.message || "Signup failed. Please check your details.");
      }
    });

    // RESET PASSWORD
    forms.reset.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("reset-email").value.trim();
      try {
        await sendPasswordResetLink(email);
        showSuccess("Reset link sent. Please check your email.");
      } catch (err) {
        console.error(err);
        showError(err.message || "Could not send reset link. Please try again.");
      }
    });
  </script>
</body>
</html>
