<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - ReviewResQ</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <h2>Your Reviews Dashboard</h2>

    <p id="businessName"></p>

    <h3>Customer Reviews</h3>
    <div id="reviewsList"></div>
  </div>

  <script type="module">
    import { db } from "./firebase.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    async function loadDashboard() {
      const businessId = localStorage.getItem("businessId");
      if (!businessId) {
        window.location.href = "login.html";
        return;
      }

      const ref = doc(db, "businesses", businessId);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        document.getElementById("businessName").innerText =
          "Business not found.";
        return;
      }

      const data = snap.data();
      document.getElementById("businessName").innerText =
        "Business: " + data.businessName;

      // Reviews
      const reviewsDiv = document.getElementById("reviewsList");
      const reviews = data.reviews || [];

      if (reviews.length === 0) {
        reviewsDiv.innerHTML = "<p>No reviews yet.</p>";
        return;
      }

      reviews.forEach((r) => {
        const item = document.createElement("div");
        item.className = "reviewItem";
        item.innerHTML = `
          <strong>${r.reviewerName}</strong> - ⭐ ${r.rating}<br/>
          <p>${r.comment}</p>
          <small>${r.date}</small>
        `;
        reviewsDiv.appendChild(item);
      });
    }

    loadDashboard();
  </script>
  <script type="module">
  import { db } from "./firebase.js";
  import {
    getFirestore,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  console.log("Dashboard connected to Firestore");

  async function loadReviews() {
    console.log("Loading reviews from Firestore...");

    // כרגע רק בדיקה פשוטה – קורא את כל המסמכים מקולקציה businesses
    const querySnapshot = await getDocs(collection(db, "businesses"));

    querySnapshot.forEach((doc) => {
      console.log(doc.id, " => ", doc.data());
    });
  }

  loadReviews();
</script>
</body>
</html>
