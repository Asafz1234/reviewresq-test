<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - ReviewResQ</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- TOP BAR -->
  <header class="topbar">
    <div class="topbar-left">
      <!-- שים בקובץ הלוגו שלך בשם logo.png בתיקייה הראשית -->
      <img src="logo.png" alt="ReviewResQ logo" class="topbar-logo" />
      <span class="topbar-brand">ReviewResQ</span>
    </div>
    <button class="btn btn-ghost" onclick="logout()">Logout</button>
  </header>

  <!-- MAIN DASHBOARD SHELL -->
  <main class="dashboard-shell">
    <section class="dashboard-header">
      <div>
        <h1 class="page-title">Your Reviews Dashboard</h1>
        <p class="page-subtitle">
          Business:
          <span id="businessName">Loading…</span>
        </p>
      </div>
    </section>

    <!-- METRICS CARDS -->
    <section class="card card-metrics">
      <div class="metrics-grid">
        <div class="metric">
          <p class="metric-label">Total Reviews</p>
          <p class="metric-value" id="totalReviews">0</p>
        </div>

        <div class="metric">
          <p class="metric-label">Bad Reviews Rescued</p>
          <p class="metric-value metric-danger" id="badReviews">0</p>
        </div>

        <div class="metric">
          <p class="metric-label">Monthly Growth</p>
          <p class="metric-value metric-success" id="monthlyGrowth">0%</p>
        </div>

        <div class="metric">
          <p class="metric-label">Review Invites Sent</p>
          <p class="metric-value" id="reviewInvites">0</p>
        </div>
      </div>
    </section>

    <!-- REVIEWS LIST -->
    <section class="card card-reviews">
      <div class="card-header">
        <h2 class="card-title">Customer Reviews</h2>
        <p class="card-subtitle">Live feedback from your customers</p>
      </div>

      <div id="reviews" class="reviews-list">
        <!-- JS ימלא פה את הביקורות -->
        <p class="empty-state">No reviews yet.</p>
      </div>
    </section>
  </main>

  <!-- JS -->
  <script type="module">
    import { db } from "./firebase.js";
    import {
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    console.log("Dashboard connected to Firestore");

    async function loadDashboard() {
      console.log("Loading dashboard...");

      const businessId = localStorage.getItem("businessId");
      if (!businessId) {
        window.location.href = "login.html";
        return;
      }

      const ref = doc(db, "businesses", businessId);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        document.getElementById("businessName").innerText =
          "Business not found.";
        return;
      }

      const data = snap.data();

      // שם עסק
      document.getElementById("businessName").innerText =
        data.businessName || "Unknown";

      // סטטיסטיקות בסיסיות
      const reviews = data.reviews || [];
      const total = reviews.length;
      const badRescued = 0; // placeholder לעתיד
      const invites = 0;    // placeholder לעתיד

      document.getElementById("totalReviews").innerText = total;
      document.getElementById("badReviews").innerText = badRescued;
      document.getElementById("monthlyGrowth").innerText = "0%";
      document.getElementById("reviewInvites").innerText = invites;

      // הצגת ביקורות
      const reviewsDiv = document.getElementById("reviews");
      reviewsDiv.innerHTML = "";

      if (!Array.isArray(reviews) || reviews.length === 0) {
        reviewsDiv.innerHTML = "<p class='empty-state'>No reviews yet.</p>";
        return;
      }

      reviews.forEach((r) => {
        const item = document.createElement("article");
        item.className = "review-item";
        item.innerHTML = `
          <div class="review-header">
            <div class="review-main">
              <div class="reviewer-name">${r.reviewerName || "Customer"}</div>
              <div class="review-date">${r.date || ""}</div>
            </div>
            <div class="review-rating">
              <span class="star">★</span>
              <span class="rating-value">${r.rating || "-"}</span>
            </div>
          </div>
          <p class="review-comment">${r.comment || ""}</p>
        `;
        reviewsDiv.appendChild(item);
      });
    }

    // כפתור יציאה
    window.logout = function () {
      localStorage.removeItem("businessId");
      window.location.href = "login.html";
    };

    loadDashboard();
  </script>
</body>
</html>
