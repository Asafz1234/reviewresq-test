<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - ReviewResQ</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <h2>Your Reviews Dashboard</h2>

    <p id="businessName"></p>

    <h3>Customer Reviews</h3>
    <div id="reviews"></div>
  </div>

 <script type="module">
  import { db } from "./firebase.js";
  import {
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  console.log("Dashboard connected to Firestore");

  async function loadDashboard() {
    console.log("Loading dashboard...");

    const businessId = localStorage.getItem("businessId");
    if (!businessId) {
      window.location.href = "login.html";
      return;
    }

    const ref = doc(db, "businesses", businessId);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
      document.getElementById("businessName").innerText =
        "Business not found.";
      return;
    }

    const data = snap.data();

    // מציג שם עסק
    document.getElementById("businessName").innerText =
      "Business: " + (data.businessName || "Unknown");

    // מציג ביקורות - עכשיו לוקח ישירות את המערך
    const reviews = data.reviews || [];

    const reviewsDiv = document.getElementById("reviews");
    reviewsDiv.innerHTML = "";

    if (!Array.isArray(reviews) || reviews.length === 0) {
      reviewsDiv.innerHTML = "<p>No reviews yet.</p>";
      return;
    }

    reviews.forEach((r) => {
      const item = document.createElement("div");
      item.className = "reviewItem";
      item.innerHTML = `
        <strong>${r.reviewerName}</strong> - ⭐ ${r.rating}<br/>
        <p>${r.comment}</p>
        <small>${r.date}</small>
      `;
      reviewsDiv.appendChild(item);
    });
  }

  loadDashboard();
</script>
</body>
</html>
